var Spry;Spry||(Spry={}),Spry.Widget||(Spry.Widget={}),Spry.Widget.Accordion=function(a,b){this.element=this.getElement(a),this.defaultPanel=0,this.hoverClass="AccordionPanelTabHover",this.openClass="AccordionPanelOpen",this.closedClass="AccordionPanelClosed",this.focusedClass="AccordionFocused",this.enableAnimation=!0,this.enableKeyboardNavigation=!0,this.currentPanel=null,this.animator=null,this.hasFocus=null,this.previousPanelKeyCode=Spry.Widget.Accordion.KEY_UP,this.nextPanelKeyCode=Spry.Widget.Accordion.KEY_DOWN,this.useFixedPanelHeights=!0,this.fixedPanelHeight=0,Spry.Widget.Accordion.setOptions(this,b,!0),this.attachBehaviors()},Spry.Widget.Accordion.prototype.getElement=function(a){return a&&"string"==typeof a?document.getElementById(a):a},Spry.Widget.Accordion.prototype.addClassName=function(a,b){!a||!b||a.className&&-1!=a.className.search(new RegExp("\\b"+b+"\\b"))||(a.className+=(a.className?" ":"")+b)},Spry.Widget.Accordion.prototype.removeClassName=function(a,b){!a||!b||a.className&&-1==a.className.search(new RegExp("\\b"+b+"\\b"))||(a.className=a.className.replace(new RegExp("\\s*\\b"+b+"\\b","g"),""))},Spry.Widget.Accordion.setOptions=function(a,b,c){if(b)for(var d in b)c&&void 0==b[d]||(a[d]=b[d])},Spry.Widget.Accordion.prototype.onPanelTabMouseOver=function(a,b){return b&&this.addClassName(this.getPanelTab(b),this.hoverClass),!1},Spry.Widget.Accordion.prototype.onPanelTabMouseOut=function(a,b){return b&&this.removeClassName(this.getPanelTab(b),this.hoverClass),!1},Spry.Widget.Accordion.prototype.openPanel=function(a){var c,b=this.currentPanel;if(!(c="number"==typeof a?this.getPanels()[a]:this.getElement(a))||b==c)return null;var d=b?this.getPanelContent(b):null,e=this.getPanelContent(c);return e?(this.useFixedPanelHeights&&!this.fixedPanelHeight&&(this.fixedPanelHeight=d.offsetHeight?d.offsetHeight:d.scrollHeight),this.enableAnimation?(this.animator&&this.animator.stop(),this.animator=new Spry.Widget.Accordion.PanelAnimator(this,c,{duration:this.duration,fps:this.fps,transition:this.transition}),this.animator.start()):(d&&(d.style.display="none",d.style.height="0px"),e.style.display="block",e.style.height=this.useFixedPanelHeights?this.fixedPanelHeight+"px":"auto"),b&&(this.removeClassName(b,this.openClass),this.addClassName(b,this.closedClass)),this.removeClassName(c,this.closedClass),this.addClassName(c,this.openClass),this.currentPanel=c,c):null},Spry.Widget.Accordion.prototype.closePanel=function(){if(!this.useFixedPanelHeights&&this.currentPanel){var a=this.currentPanel,b=this.getPanelContent(a);b&&(this.enableAnimation?(this.animator&&this.animator.stop(),this.animator=new Spry.Widget.Accordion.PanelAnimator(this,null,{duration:this.duration,fps:this.fps,transition:this.transition}),this.animator.start()):(b.style.display="none",b.style.height="0px")),this.removeClassName(a,this.openClass),this.addClassName(a,this.closedClass),this.currentPanel=null}},Spry.Widget.Accordion.prototype.openNextPanel=function(){return this.openPanel(this.getCurrentPanelIndex()+1)},Spry.Widget.Accordion.prototype.openPreviousPanel=function(){return this.openPanel(this.getCurrentPanelIndex()-1)},Spry.Widget.Accordion.prototype.openFirstPanel=function(){return this.openPanel(0)},Spry.Widget.Accordion.prototype.openLastPanel=function(){var a=this.getPanels();return this.openPanel(a[a.length-1])},Spry.Widget.Accordion.prototype.onPanelTabClick=function(a,b){return b!=this.currentPanel?this.openPanel(b):this.closePanel(),this.enableKeyboardNavigation&&this.focus(),a.preventDefault?a.preventDefault():a.returnValue=!1,a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,!1},Spry.Widget.Accordion.prototype.onFocus=function(a){return this.hasFocus=!0,this.addClassName(this.element,this.focusedClass),!1},Spry.Widget.Accordion.prototype.onBlur=function(a){return this.hasFocus=!1,this.removeClassName(this.element,this.focusedClass),!1},Spry.Widget.Accordion.KEY_UP=38,Spry.Widget.Accordion.KEY_DOWN=40,Spry.Widget.Accordion.prototype.onKeyDown=function(a){var b=a.keyCode;if(!this.hasFocus||b!=this.previousPanelKeyCode&&b!=this.nextPanelKeyCode)return!0;var c=this.getPanels();if(!c||c.length<1)return!1;for(var d=this.currentPanel?this.currentPanel:c[0],e=b==this.nextPanelKeyCode?d.nextSibling:d.previousSibling;e&&1!=e.nodeType;)e=b==this.nextPanelKeyCode?e.nextSibling:e.previousSibling;return e&&d!=e&&this.openPanel(e),a.preventDefault?a.preventDefault():a.returnValue=!1,a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,!1},Spry.Widget.Accordion.prototype.attachPanelHandlers=function(a){if(a){var b=this.getPanelTab(a);if(b){var c=this;Spry.Widget.Accordion.addEventListener(b,"click",function(b){return c.onPanelTabClick(b,a)},!1),Spry.Widget.Accordion.addEventListener(b,"mouseover",function(b){return c.onPanelTabMouseOver(b,a)},!1),Spry.Widget.Accordion.addEventListener(b,"mouseout",function(b){return c.onPanelTabMouseOut(b,a)},!1)}}},Spry.Widget.Accordion.addEventListener=function(a,b,c,d){try{a.addEventListener?a.addEventListener(b,c,d):a.attachEvent&&a.attachEvent("on"+b,c)}catch(a){}},Spry.Widget.Accordion.prototype.initPanel=function(a,b){var c=this.getPanelContent(a);b?(this.currentPanel=a,this.removeClassName(a,this.closedClass),this.addClassName(a,this.openClass),c&&(this.useFixedPanelHeights?this.fixedPanelHeight&&(c.style.height=this.fixedPanelHeight+"px"):c.style.height="auto")):(this.removeClassName(a,this.openClass),this.addClassName(a,this.closedClass),c&&(c.style.height="0px",c.style.display="none")),this.attachPanelHandlers(a)},Spry.Widget.Accordion.prototype.attachBehaviors=function(){for(var a=this.getPanels(),b=0;b<a.length;b++)this.initPanel(a[b],b==this.defaultPanel);if(this.enableKeyboardNavigation=this.enableKeyboardNavigation&&this.element.attributes.getNamedItem("tabindex"),this.enableKeyboardNavigation){var c=this;Spry.Widget.Accordion.addEventListener(this.element,"focus",function(a){return c.onFocus(a)},!1),Spry.Widget.Accordion.addEventListener(this.element,"blur",function(a){return c.onBlur(a)},!1),Spry.Widget.Accordion.addEventListener(this.element,"keydown",function(a){return c.onKeyDown(a)},!1)}},Spry.Widget.Accordion.prototype.getPanels=function(){return this.getElementChildren(this.element)},Spry.Widget.Accordion.prototype.getCurrentPanel=function(){return this.currentPanel},Spry.Widget.Accordion.prototype.getPanelIndex=function(a){for(var b=this.getPanels(),c=0;c<b.length;c++)if(a==b[c])return c;return-1},Spry.Widget.Accordion.prototype.getCurrentPanelIndex=function(){return this.getPanelIndex(this.currentPanel)},Spry.Widget.Accordion.prototype.getPanelTab=function(a){return a?this.getElementChildren(a)[0]:null},Spry.Widget.Accordion.prototype.getPanelContent=function(a){return a?this.getElementChildren(a)[1]:null},Spry.Widget.Accordion.prototype.getElementChildren=function(a){for(var b=[],c=a.firstChild;c;)1==c.nodeType&&b.push(c),c=c.nextSibling;return b},Spry.Widget.Accordion.prototype.focus=function(){this.element&&this.element.focus&&this.element.focus()},Spry.Widget.Accordion.prototype.blur=function(){this.element&&this.element.blur&&this.element.blur()},Spry.Widget.Accordion.PanelAnimator=function(a,b,c){this.timer=null,this.interval=0,this.fps=60,this.duration=500,this.startTime=0,this.transition=Spry.Widget.Accordion.PanelAnimator.defaultTransition,this.onComplete=null,this.panel=b,this.panelToOpen=a.getElement(b),this.panelData=[],this.useFixedPanelHeights=a.useFixedPanelHeights,Spry.Widget.Accordion.setOptions(this,c,!0),this.interval=Math.floor(1e3/this.fps);for(var d=a.getPanels(),e=0;e<d.length;e++){var f=d[e],g=a.getPanelContent(f);if(g){var h=g.offsetHeight;if(void 0==h&&(h=0),f==b&&0==h&&(g.style.display="block"),f==b||h>0){var i=new Object;i.panel=f,i.content=g,i.fromHeight=h,i.toHeight=f==b?a.useFixedPanelHeights?a.fixedPanelHeight:g.scrollHeight:0,i.distance=i.toHeight-i.fromHeight,i.overflow=g.style.overflow,this.panelData.push(i),g.style.overflow="hidden",g.style.height=h+"px"}}}},Spry.Widget.Accordion.PanelAnimator.defaultTransition=function(a,b,c,d){return a/=d,b+(2-a)*a*c},Spry.Widget.Accordion.PanelAnimator.prototype.start=function(){var a=this;this.startTime=(new Date).getTime(),this.timer=setTimeout(function(){a.stepAnimation()},this.interval)},Spry.Widget.Accordion.PanelAnimator.prototype.stop=function(){if(this.timer)for(clearTimeout(this.timer),i=0;i<this.panelData.length;i++)obj=this.panelData[i],obj.content.style.overflow=obj.overflow;this.timer=null},Spry.Widget.Accordion.PanelAnimator.prototype.stepAnimation=function(){var c,d,a=(new Date).getTime(),b=a-this.startTime;if(b>=this.duration){for(c=0;c<this.panelData.length;c++)d=this.panelData[c],d.panel!=this.panel&&(d.content.style.display="none",d.content.style.height="0px"),d.content.style.overflow=d.overflow,d.content.style.height=this.useFixedPanelHeights||0==d.toHeight?d.toHeight+"px":"auto";return void(this.onComplete&&this.onComplete())}for(c=0;c<this.panelData.length;c++){d=this.panelData[c];var e=this.transition(b,d.fromHeight,d.distance,this.duration);d.content.style.height=(e<0?0:e)+"px"}var f=this;this.timer=setTimeout(function(){f.stepAnimation()},this.interval)};